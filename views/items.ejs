<%- include('partials/header') %>

<div class="container mt-5">
    <h1>Items</h1>

    <!-- Category Filter -->
    <form method="GET" action="/items" class="mb-4">
        <label for="category">Filter by Category:</label>
        <select name="category" id="category" onchange="this.form.submit()">
            <option value="">All Categories</option>
            <% categories.forEach(category => { %>
                <option value="<%= category.id %>" <%= selectedCategory == category.id ? "selected" : "" %>>
                    <%= category.name %>
                </option>
            <% }); %>
        </select>
    </form>

    <!-- Item Table -->
    <% if (items.length > 0) { %>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Date</th>
                    <th>Price</th>
                    <th>Category</th>
                    <th>Published</th>
                </tr>
            </thead>
            <tbody>
                <% items.forEach(item => { %>
                    <tr>
                        <td><%= item.id %></td>
                        <td><%= item.title %></td>
                        <td><%= item.postDate %></td>
                        <td>$<%= item.price.toFixed(2) %></td>
                        <td>
                            <% const matchedCategory = categories.find(cat => cat.id == item.category); %>
                            <%= matchedCategory ? matchedCategory.name : 'Unknown Category' %>
                        </td>
                        <td><%= item.published ? 'Yes' : 'No' %></td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    <% } else { %>
        <strong><%= message %></strong>
    <% } %>
</div>

<%- include('partials/footer') %>
